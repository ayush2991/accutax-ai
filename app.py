import time
import streamlit as st
import logging
import random
from openai import OpenAI
import os

# ----------------------------------- Function Definitions -------------------------------------- #
MODEL="gpt-4.1-nano"
VECTOR_STORE_ID="vs_6843d4f0bb5c8191ae486696e53fcf60"
INCOME_TAX_FILEPATH="./assets/income-tax-act-1961-amended-2024.pdf"

# Setup logging
def setup_logging():
    """Configure logging with proper formatting and file output."""
    log_dir = "logs"
    if not os.path.exists(log_dir):
        os.makedirs(log_dir)
        
    logging.basicConfig(
        level=logging.INFO,
        format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
        handlers=[
            logging.FileHandler(os.path.join(log_dir, 'app.log')),
            logging.StreamHandler()
        ]
    )
    return logging.getLogger(__name__)


def parse_response(response):
    '''
    Response(
    (id = "resp_6843e6c751e4819ea9a8419860fc1b7f0ecb5de5fa8226ff"),
    (created_at = 1749280455.0),
    (error = None),
    (incomplete_details = None),
    (instructions = None),
    (metadata = {}),
    (model = "gpt-4.1-nano-2025-04-14"),
    (object = "response"),
    (output = [
        ResponseFileSearchToolCall(
            (id = "fs_6843e6c7a2b4819ea230e1cc355c5d320ecb5de5fa8226ff"),
            (queries = ["capital gains tax liability"]),
            (status = "completed"),
            (type = "file_search_call"),
            (results = [
                Result(
                    (attributes = {}),
                    (file_id = "file-Cswz8u47L6Ss5uCxPGfTPA"),
                    (filename = "income-tax-act-1961-amended-2024.pdf"),
                    (score = 0.7696),
                    (text =
                        'Tax on long-term capital gains.\n112. (1) Where the total income of an assessee includes any income, arising from the transfer of a long-term\ncapital asset, which is chargeable under the head "Capital gains", the tax payable by the assessee on the total\nincome shall be the aggregate of,—\n\n(a) in the case of an individual or a Hindu undivided family, being a resident,—\n (i) the amount of income-tax payable on the total income as reduced by the amount of such long-\n\nterm capital gains, had the total income as so reduced been his total income ; and\n(ii) the amount of income-tax calculated on such long-term capital gains at the rate of twenty per\n\ncent :\nProvided that where the total income as reduced by such long-term capital gains is below the\nmaximum amount which is not chargeable to income-tax, then, such long-term capital gains shall be\nreduced by the amount by which the total income as so reduced falls short of the maximum amount\nwhich is not chargeable to income-tax and the tax on the balance of such long-term capital gains shall\nbe computed at the rate of twenty per cent ;\n\n(b) in the case of a domestic company,—\n (i) the amount of income-tax payable on the total income as reduced by the amount of such long-\n\nterm capital gains, had the total income as so reduced been its total income ; and\n(ii) the amount of income-tax calculated on such long-term capital gains at the rate of twenty per\n\ncent;\n(c) in the case of a non-resident (not being a company) or a foreign company,—\n\n  (i) the amount of income-tax payable on the total income as reduced by the amount of such long-\nterm capital gains, had the total income as so reduced been its total income ; and\n\n (ii) the amount of income-tax calculated on long-term capital gains [except where such gain arises\nfrom transfer of capital asset referred to in sub-clause (iii)] at the rate of twenty per cent; and\n\n(iii) the amount of income-tax on long-term capital gains arising from the transfer of a capital asset,\nbeing unlisted securities or shares of a company not being a company in which the public are\nsubstantially interested, calculated at the rate of ten per cent on the capital gains in respect of\nsuch asset as computed without giving effect to the first and second proviso to section 48;\n\n(d) in any other case of a resident,—\n\n392 of 801\n\n\n\n (i) the amount of income-tax payable on the total income as reduced by the amount of long-term\ncapital gains, had the total income as so reduced been its total income ; and\n\n(ii) the amount of income-tax calculated on such long-term capital gains at the rate of twenty per\ncent.\n\nExplanation.—[***]\nProvided that where the tax payable in respect of any income arising from the transfer of a long-term\ncapital asset, being listed securities (other than a unit) or zero coupon bond, exceeds ten per cent of the\namount of capital gains before giving effect to the provisions of the second proviso to section 48, then, such\nexcess shall be ignored for the purpose of computing the tax payable by the assessee :\nProvided further that where the tax payable in respect of any income arising from the transfer of a long-\nterm capital asset, being a unit of a Mutual Fund specified under clause (23D) of section 10, during the\nperiod beginning on the 1st day of April, 2014 and ending on the 10th day of July, 2014, exceeds ten per\ncent of the amount of capital gains, before giving effect to the provisions of the second proviso to section\n48, then,'),
                ),
                Result(
                    (attributes = {}),
                    (file_id = "file-Cswz8u47L6Ss5uCxPGfTPA"),
                    (filename = "income-tax-act-1961-amended-2024.pdf"),
                    (score = 0.7023),
                    (text =
                        'were the total income of the assessee:\nProvided that in the case of an individual or a Hindu undivided family, being a resident, where the total\nincome as reduced by such short-term capital gains is below the maximum amount which is not chargeable\nto income-tax, then, such short-term capital gains shall be reduced by the amount by which the total income\nas so reduced falls short of the maximum amount which is not chargeable to income-tax and the tax on the\nbalance of such short-term capital gains shall be computed at the rate of fifteen per cent :\nProvided further that nothing contained in clause (b) shall apply to a transaction undertaken on a\nrecognised stock exchange located in any International Financial Services Centre and where the\nconsideration for such transaction is paid or payable in foreign currency.\n\n391 of 801\n\n\n\n(2) Where the gross total income of an assessee includes any short-term capital gains referred to in sub-\nsection (1), the deduction under Chapter VI-A shall be allowed from the gross total income as reduced by\nsuch capital gains.\n(3) 56[***]\nExplanation.—For the purposes of this section,—\n\n(a) "equity oriented fund" shall have the meaning assigned to it in clause (a) of the Explanation to section\n112A;\n\n(b) "International Financial Services Centre" shall have the same meaning as assigned to it in clause (q) of\nsection 2 of the Special Economic Zones Act, 2005 (28 of 2005);\n\n(c) "recognised stock exchange" shall have the meaning assigned to it in clause (ii) of the Explanation 1 to\nsub-section (5) of section 43.\n\n_________________________________________________\n\n56. Omitted by the Finance Act, 2023, w.e.f. 1-4-2023. Prior to its omission, sub-section (3) read as\nunder :\n"(3) Where the total income of an assessee includes any short-term capital gains referred to in sub-\nsection (1), the rebate under section 88 shall be allowed from the income-tax on the total income as\nreduced by such capital gains."\n\nTax on long-term capital gains.\n112. (1) Where the total income of an assessee includes any income, arising from the transfer of a long-term\ncapital asset, which is chargeable under the head "Capital gains", the tax payable by the assessee on the total\nincome shall be the aggregate of,—\n\n(a) in the case of an individual or a Hindu undivided family, being a resident,—\n (i) the amount of income-tax payable on the total income as reduced by the amount of such long-\n\nterm capital gains, had the total income as so reduced been his total income ; and\n(ii) the amount of income-tax calculated on such long-term capital gains at the rate of twenty per\n\ncent :\nProvided that where the total income as reduced by such long-term capital gains is below the\nmaximum amount which is not chargeable to income-tax, then, such long-term capital gains shall be\nreduced by the amount by which the total income as so reduced falls short of the maximum amount\nwhich is not chargeable to income-tax and the tax on the balance of such long-term capital gains shall\nbe computed at the rate of twenty per cent ;\n\n(b) in the case of a domestic company,—\n (i) the amount of income-tax payable on the total income as reduced by the amount of such long-\n\nterm capital gains, had the total income as so reduced been its total income ; and\n(ii) the amount of income-tax calculated on such long-term capital gains at the rate of twenty per\n\ncent;\n(c) in the case of a non-resident (not being a company) or a foreign company,—'),
                ),
                Result(
                    (attributes = {}),
                    (file_id = "file-Cswz8u47L6Ss5uCxPGfTPA"),
                    (filename = "income-tax-act-1961-amended-2024.pdf"),
                    (score = 0.6948),
                    (text =
                        '(iii) the amount of income-tax on long-term capital gains arising from the transfer of a capital asset,\nbeing unlisted securities or shares of a company not being a company in which the public are\nsubstantially interested, calculated at the rate of ten per cent on the capital gains in respect of\nsuch asset as computed without giving effect to the first and second proviso to section 48;\n\n(d) in any other case of a resident,—\n\n392 of 801\n\n\n\n (i) the amount of income-tax payable on the total income as reduced by the amount of long-term\ncapital gains, had the total income as so reduced been its total income ; and\n\n(ii) the amount of income-tax calculated on such long-term capital gains at the rate of twenty per\ncent.\n\nExplanation.—[***]\nProvided that where the tax payable in respect of any income arising from the transfer of a long-term\ncapital asset, being listed securities (other than a unit) or zero coupon bond, exceeds ten per cent of the\namount of capital gains before giving effect to the provisions of the second proviso to section 48, then, such\nexcess shall be ignored for the purpose of computing the tax payable by the assessee :\nProvided further that where the tax payable in respect of any income arising from the transfer of a long-\nterm capital asset, being a unit of a Mutual Fund specified under clause (23D) of section 10, during the\nperiod beginning on the 1st day of April, 2014 and ending on the 10th day of July, 2014, exceeds ten per\ncent of the amount of capital gains, before giving effect to the provisions of the second proviso to section\n48, then, such excess shall be ignored for the purpose of computing the tax payable by the assessee.\nExplanation.—For the purposes of this sub-section,—\n\n  (a) the expression "securities" shall have the meaning assigned to it in clause (h) of section 2 of the\nSecurities Contracts (Regulation) Act, 1956 (32 of 1956);\n\n(aa) "listed securities" means the securities which are listed on any recognised stock exchange in India;\n(ab) "unlisted securities" means securities other than listed securities.\n(b) [***]\n\n(2) Where the gross total income of an assessee includes any income arising from the transfer of a long-term\ncapital asset, the gross total income shall be reduced by the amount of such income and the deduction under\nChapter VI-A shall be allowed as if the gross total income as so reduced were the gross total income of the\nassessee.\n(3) 57[***]\n\n_________________________________________________\n\n57. Omitted by the Finance Act, 2023, w.e.f. 1-4-2023. Prior to its omission, sub-section (3) read as\nunder:\n"(3) Where the total income of an assessee includes any income arising from the transfer of a long-\nterm capital asset, the total income shall be reduced by the amount of such income and the rebate\nunder section 88 shall be allowed from the income-tax on the total income as so reduced."\n\nTax on long-term capital gains in certain cases.\n112A. (1) Notwithstanding anything contained in section 112, the tax payable by an assessee on his total\nincome shall be determined in accordance with the provisions of sub-section (2), if—\n\n  (i) the total income includes any income chargeable under the head "Capital gains";\n (ii) the capital gains arise from the transfer of a long-term capital asset being an equity share in a'),
                ),
                Result(
                    (attributes = {}),
                    (file_id = "file-Cswz8u47L6Ss5uCxPGfTPA"),
                    (filename = "income-tax-act-1961-amended-2024.pdf"),
                    (score = 0.668),
                    (text =
                        'the amount of profits or gains arising from the transfer of such capital asset not charged under section 45 by\nvirtue of the provisions contained in clause (iv) or, as the case may be, clause (v) of section 47 shall,\nnotwithstanding anything contained in the said clauses, be deemed to be income chargeable under the head\n"Capital gains" of the previous year in which such transfer took place.\n(2) Where at any time, before the expiry of a period of three years from the date of the transfer of a capital\nasset referred to in clause (xi) of section 47, any of the shares allotted to the transferor in exchange of a\nmembership in a recognised stock exchange are transferred, the amount of profits and gains not charged\nunder section 45 by virtue of the provisions contained in clause (xi) of section 47 shall, notwithstanding\nanything contained in the said clause, be deemed to be the income chargeable under the head "Capital gains"\nof the previous year in which such shares are transferred.\n(3) Where any of the conditions laid down in the proviso to clause (xiii) or the proviso to clause (xiv) of\nsection 47 are not complied with, the amount of profits or gains arising from the transfer of such capital\nasset or intangible asset not charged under section 45 by virtue of conditions laid down in the proviso to\nclause (xiii) or the proviso to clause (xiv) of section 47 shall be deemed to be the profits and gains\nchargeable to tax of the successor company for the previous year in which the requirements of the proviso to\nclause (xiii) or the proviso to clause (xiv), as the case may be, are not complied with.\n(4) Where any of the conditions laid down in the proviso to clause (xiiib) of section 47 are not complied\nwith, the amount of profits or gains arising from the transfer of such capital asset or intangible assets or\nshare or shares not charged under section 45 by virtue of conditions laid down in the said proviso shall be\ndeemed to be the profits and gains chargeable to tax of the successor limited liability partnership or the\nshareholder of the predecessor company, as the case may be, for the previous year in which the requirements\nof the said proviso are not complied with.\n\nMode of computation.\n48. The income chargeable under the head "Capital gains" shall be computed, by deducting from the full\nvalue of the consideration received or accruing as a result of the transfer of the capital asset the following\namounts, namely :—\n\n(i) expenditure incurred wholly and exclusively in connection with such transfer;\n(ii) the cost of acquisition of the asset and the cost of any improvement thereto;\n\nFollowing shall be inserted in clause (ii) of section 48 by the Finance Act, 2023, w.e.f. 1-4-2024:\nProvided that the cost of acquisition of the asset or the cost of improvement thereto shall not include\nthe deductions claimed on the amount of interest under clause (b) of section 24 or under the\nprovisions of Chapter VIA.\nExplanation 1.—For the removal of doubt, it is hereby clarified that the cost of acquisition of a unit of\na business trust shall be reduced and shall be deemed to have always been reduced by any sum\nreceived by a unit holder from the business trust with respect to such unit, which is not in the nature of\nincome as referred to in clause (23FC) or clause (23FCA) of section 10 and which is not chargeable\nto tax under clause (xii) of sub-section (2) of section 56 and under sub-section (2) of section 115UA.'),
                ),
                Result(
                    (attributes = {}),
                    (file_id = "file-Cswz8u47L6Ss5uCxPGfTPA"),
                    (filename = "income-tax-act-1961-amended-2024.pdf"),
                    (score = 0.6602),
                    (text =
                        'and the capital gains shall be\ndeemed to be the income of the previous year in which such transfer takes place and the provisions of this\nAct, other than the provisions of this sub-section, shall apply for the purpose of determination of full value\nof consideration received or accruing as a result of such transfer.\nExplanation.—For the purposes of this sub-section, the expression—\n\n(i) "competent authority" means the authority empowered to approve the building plan by or under any\nlaw for the time being in force;\n\n(ii) "specified agreement" means a registered agreement in which a person owning land or building or\nboth, agrees to allow another person to develop a real estate project on such land or building or both,\nin consideration of a share, being land or building or both in such project, whether with or without\npayment of part of the consideration in cash;\n\n(iii) "stamp duty value" means the value adopted or assessed or assessable by any authority of the\nGovernment for the purpose of payment of stamp duty in respect of an immovable property being land\nor building or both.\n\n(6) Notwithstanding anything contained in sub-section (1), the difference between the repurchase price of\nthe units referred to in sub-section (2) of section 80CCB and the capital value of such units shall be deemed\nto be the capital gains arising to the assessee in the previous year in which such repurchase takes place or\nthe plan referred to in that section is terminated and shall be taxed accordingly.\nExplanation.—For the purposes of this sub-section, "capital value of such units" means any amount invested\nby the assessee in the units referred to in sub-section (2) of section 80CCB.\n\n_________________________________________________\n\n81. Inserted by the Finance Act, 2021, w.e.f. 1-4-2021.\n82. See rule 8AD.\n82a. Substituted by the Finance Act, 2021, w.e.f. 1-4-2021.\n83. Words "any consideration received in cash or by a cheque or draft or by any other mode" shall be\n\nsubstituted for "the consideration received in cash, if any," by the Finance Act, 2023, w.e.f. 1-4-\n2024.\n\nCapital gains on distribution of assets by companies in liquidation.\n46. (1) Notwithstanding anything contained in section 45, where the assets of a company are distributed to\nits shareholders on its liquidation, such distribution shall not be regarded as a transfer by the company for\nthe purposes of section 45.\n(2) Where a shareholder on the liquidation of a company receives any money or other assets from the\ncompany, he shall be chargeable to income-tax under the head "Capital gains", in respect of the money so\nreceived or the market value of the other assets on the date of distribution, as reduced by the amount\n\n217 of 801\n\n\n\nassessed as dividend within the meaning of sub-clause (c) of clause (22) of section 2 and the sum so arrived\nat shall be deemed to be the full value of the consideration for the purposes of section 48.\n\nCapital gains on purchase by company of its own shares or other specified securities.\n46A.'),
                ),
                Result(
                    (attributes = {}),
                    (file_id = "file-Cswz8u47L6Ss5uCxPGfTPA"),
                    (filename = "income-tax-act-1961-amended-2024.pdf"),
                    (score = 0.5744),
                    (text =
                        'E.—Capital gains \nCapital gains.\n45. (1) Any profits or gains arising from the transfer of a capital asset effected in the previous year shall,\nsave as otherwise provided in sections 54, 54B, 54D, 54E, 54EA, 54EB, 54F, 54G and 54H, be chargeable\nto income-tax under the head "Capital gains", and shall be deemed to be the income of the previous year in\nwhich the transfer took place.\n(1A) Notwithstanding anything contained in sub-section (1), where any person receives at any time during\nany previous year any money or other assets under an insurance from an insurer on account of damage to, or\ndestruction of, any capital asset, as a result of—\n\n(i) flood, typhoon, hurricane, cyclone, earthquake or other convulsion of nature; or\n(ii) riot or civil disturbance; or\n(iii) accidental fire or explosion; or\n\n214 of 801\n\n\n\n(iv) action by an enemy or action taken in combating an enemy (whether with or without a declaration of\nwar),\n\nthen, any profits or gains arising from receipt of such money or other assets shall be chargeable to income-\ntax under the head "Capital gains" and shall be deemed to be the income of such person of the previous year\nin which such money or other asset was received and for the purposes of section 48, value of any money or\nthe fair market value of other assets on the date of such receipt shall be deemed to be the full value of the\nconsideration received or accruing as a result of the transfer of such capital asset.\nExplanation.—For the purposes of this sub-section, the expression "insurer" shall have the meaning\nassigned to it in clause (9) of section 2 of the Insurance Act, 1938 (4 of 1938).\n81[(1B) Notwithstanding anything contained in sub-section (1), where any person receives at any time\nduring any previous year any amount under a unit linked insurance policy, to which exemption under clause\n(10D) of section 10 does not apply on account of the applicability of the fourth and fifth provisos thereof,\nincluding the amount allocated by way of bonus on such policy, then, any profits or gains arising from\nreceipt of such amount by such person shall be chargeable to income-tax under the head "Capital gains" and\nshall be deemed to be the income of such person of the previous year in which such amount was received\nand the income taxable shall be calculated in such manner as may be prescribed82.]\n(2) Notwithstanding anything contained in sub-section (1), the profits or gains arising from the transfer by\nway of conversion by the owner of a capital asset into, or its treatment by him as stock-in-trade of a business\ncarried on by him shall be chargeable to income-tax as his income of the previous year in which such stock-\nin-trade is sold or otherwise transferred by him and, for the purposes of section 48, the fair market value of\nthe asset on the date of such conversion or treatment shall be deemed to be the full value of the\nconsideration received or accruing as a result of the transfer of the capital asset.'),
                ),
                Result(
                    (attributes = {}),
                    (file_id = "file-Cswz8u47L6Ss5uCxPGfTPA"),
                    (filename = "income-tax-act-1961-amended-2024.pdf"),
                    (score = 0.5068),
                    (text =
                        "then,—\n\n (i) the amount not so utilised shall be charged under section 45 as the income of the previous year in\nwhich the period of three years from the date of the transfer of the original asset expires; and\n\n (ii) the assessee shall be entitled to withdraw such amount in accordance with the scheme aforesaid.\n\nCapital gain on transfer of residential property not to be charged in certain cases.\n54GB. (1) Where,—\n\n (i) the capital gain arises from the transfer of a long-term capital asset, being a residential property (a\nhouse or a plot of land), owned by the eligible assessee (herein referred to as the assessee); and\n\n (ii) the assessee, before the due date of furnishing of return of income under sub-section (1) of section\n139, utilises the net consideration for subscription in the equity shares of an eligible company (herein\nreferred to as the company); and\n\n (iii) the company has, within one year from the date of subscription in equity shares by the assessee,\nutilised this amount for purchase of new asset,\n\nthen, instead of the capital gain being charged to income-tax as the income of the previous year in which the\ntransfer takes place, it shall be dealt with in accordance with the following provisions of this section, that is\nto say,—\n\n247 of 801\n\n\n\n (a) if the amount of the net consideration is greater than the cost of the new asset, then, so much of the\ncapital gain as it bears to the whole of the capital gain the same proportion as the cost of the new asset\nbears to the net consideration, shall not be charged under section 45 as the income of the previous\nyear; or\n\n (b) if the amount of the net consideration is equal to or less than the cost of the new asset, the capital gain\nshall not be charged under section 45 as the income of the previous year.\n\n(2) The amount of the net consideration, which has been received by the company for issue of shares to the\nassessee, to the extent it is not utilised by the company for the purchase of the new asset before the due date\nof furnishing of the return of income by the assessee under section 139, shall be deposited by the company,\nbefore the said due date in an account in any such bank or institution as may be specified and shall be\nutilised in accordance with any scheme which the Central Government may, by notification in the Official\nGazette, frame in this behalf and the return furnished by the assessee shall be accompanied by proof of such\ndeposit having been made.\n(3) For the purposes of sub-section (1), the amount, if any, already utilised by the company for the purchase\nof the new asset together with the amount deposited under sub-section (2) shall be deemed to be the cost of\nthe new asset:\nProvided that if the amount so deposited is not utilised, wholly or partly, for the purchase of the new asset\nwithin the period specified in sub-section (1), then,—\n\n (i) the amount by which—\n  (a) the amount of capital gain arising from the transfer of the residential property not charged\n\nunder section 45 on the basis of the cost of the new asset as provided in sub-section (1),\nexceeds—\n\n  (b) the amount that would not have been so charged had the amount actually utilised for the\npurchase of the new asset within the period specified in sub-section (1) been the cost of the\nnew asset,\n\nshall be charged under section 45 as income of the assessee for the previous year in which the period\nof one year from the date of the subscription in equity shares by the assessee expires; and"),
                ),
                Result(
                    (attributes = {}),
                    (file_id = "file-Cswz8u47L6Ss5uCxPGfTPA"),
                    (filename = "income-tax-act-1961-amended-2024.pdf"),
                    (score = 0.4952),
                    (text =
                        "Capital gain on compulsory acquisition of lands and buildings not to be charged in certain cases.\n54D. (1) Subject to the provisions of sub-section (2), where the capital gain arises from the transfer by way\nof compulsory acquisition under any law of a capital asset, being land or building or any right in land or\nbuilding, forming part of an industrial undertaking belonging to the assessee which, in the two years\nimmediately preceding the date on which the transfer took place, was being used by the assessee for the\npurposes of the business of the said undertaking (hereafter in this section referred to as the original asset),\nand the assessee has within a period of three years after that date purchased any other land or building or\nany right in any other land or building or constructed any other building for the purposes of shifting or re-\nestablishing the said undertaking or setting up another industrial undertaking, then, instead of the capital\ngain being charged to income-tax as the income of the previous year in which the transfer took place, it shall\nbe dealt with in accordance with the following provisions of this section, that is to say,—\n\n(i) if the amount of the capital gain is greater than the cost of the land, building or right so purchased or\nthe building so constructed (such land, building or right being hereafter in this section referred to as\nthe new asset), the difference between the amount of the capital gain and the cost of the new asset\nshall be charged under section 45 as the income of the previous year; and for the purpose of\ncomputing in respect of the new asset any capital gain arising from its transfer within a period of three\nyears of its purchase or construction, as the case may be, the cost shall be nil; or\n\n(ii) if the amount of the capital gain is equal to or less than the cost of the new asset, the capital gain shall\nnot be charged under section 45; and for the purpose of computing in respect of the new asset any\ncapital gain arising from its transfer within a period of three years of its purchase or construction, as\nthe case may be, the cost shall be reduced by the amount of the capital gain.\n\n(2) The amount of the capital gain which is not utilised by the assessee for the purchase or construction of\nthe new asset before the date of furnishing the return of income under section 139, shall be deposited by him\nbefore furnishing such return [such deposit being made in any case not later than the due date applicable in\nthe case of the assessee for furnishing the return of income under sub-section (1) of section 139] in an\naccount in any such bank or institution as may be specified in, and utilised in accordance with, any scheme\nwhich the Central Government may, by notification in the Official Gazette, frame in this behalf and such\nreturn shall be accompanied by proof of such deposit; and, for the purposes of sub-section (1), the amount,\nif any, already utilised by the assessee for the purchase or construction of the new asset together with the\namount so deposited shall be deemed to be the cost of the new asset:\nProvided that if the amount deposited under this sub-section is not utilised wholly or partly for the purchase\nor construction of the new asset within the period specified in sub-section (1), then,—\n\n(i) the amount not so utilised shall be charged under section 45 as the income of the previous year in\nwhich the period of three years from the date of the transfer of the original asset expires; and\n\n(ii) the assessee shall be entitled to withdraw such amount in accordance with the scheme aforesaid.\nExplanation.—[Omitted by the Finance Act, 1992, w.e.f. 1-4-1993.]\n\n236 of 801"),
                ),
                Result(
                    (attributes = {}),
                    (file_id = "file-Cswz8u47L6Ss5uCxPGfTPA"),
                    (filename = "income-tax-act-1961-amended-2024.pdf"),
                    (score = 0.4784),
                    (text =
                        '(37A) any income chargeable under the head "Capital gains" in respect of transfer of a specified\ncapital asset arising to an assessee, being an individual or a Hindu undivided family, who was\nthe owner of such specified capital asset as on the 2nd day of June, 2014 and transfers that\nspecified capital asset under the Land Pooling Scheme (herein referred to as "the scheme")\ncovered under the Andhra Pradesh Capital City Land Pooling Scheme (Formulation and\nImplementation) Rules, 2015 made under the provisions of the Andhra Pradesh Capital Region\nDevelopment Authority Act, 2014 (Andhra Pradesh Act 11 of 2014) and the rules, regulations\nand Schemes made under the said Act.\nExplanation.—For the purposes of this clause, "specified capital asset" means,—\n\n  (a) the land or building or both owned by the assessee as on the 2nd day of June, 2014 and\nwhich has been transferred under the scheme; or\n\n  (b) the land pooling ownership certificate issued under the scheme to the assessee in respect\nof land or building or both referred to in clause (a); or\n\n  (c) the reconstituted plot or land, as the case may be, received by the assessee in lieu of land\nor building or both referred to in clause (a) in accordance with the scheme, if such plot or\nland, as the case may be, so received is transferred within two years from the end of the\nfinancial year in which the possession of such plot or land was handed over to him;\n\n(38) any income arising from the transfer of a long-term capital asset, being an equity share in a\ncompany or a unit of an equity oriented fund or a unit of a business trust where—\n\n76 of 801\n\n\n\n  (a) the transaction of sale of such equity share or unit is entered into on or after the date on\nwhich Chapter VII of the Finance (No. 2) Act, 2004 comes into force; and\n\n  (b) such transaction is chargeable to securities transaction tax under that Chapter :\nProvided that the income by way of long-term capital gain of a company shall be taken into\naccount in computing the book profit and income-tax payable under section 115JB :\nProvided also* that nothing contained in sub-clause (b) shall apply to a transaction undertaken\non a recognised stock exchange located in any International Financial Services Centre and\nwhere the consideration for such transaction is paid or payable in foreign currency:\nProvided also that nothing contained in this clause shall apply to any income arising from the\ntransfer of a long-term capital asset, being an equity share in a company, if the transaction of\nacquisition, other than the acquisition notified by the Central Government in this behalf, of\nsuch equity share is entered into on or after the 1st day of October, 2004 and such transaction is\nnot chargeable to securities transaction tax under Chapter VII of the Finance (No. 2) Act, 2004\n(23 of 2004):\nProvided also that nothing contained in this clause shall apply to any income arising from the\ntransfer of long-term capital asset, being an equity share in a company or a unit of an equity\noriented fund or a unit of a business trust, made on or after the 1st day of April, 2018.\nExplanation.—For the purposes of this clause,—\n\n  (a) "equity oriented fund" means a fund—\n  (i) where the investible funds are invested by way of equity shares in domestic\n\ncompanies to the extent of more than sixty-five per cent of the total proceeds of such\nfund; and'),
                ),
                Result(
                    (attributes = {}),
                    (file_id = "file-Cswz8u47L6Ss5uCxPGfTPA"),
                    (filename = "income-tax-act-1961-amended-2024.pdf"),
                    (score = 0.4388),
                    (text =
                        '(2A) Where any person has had at any time during previous year any beneficial interest in any securities,\nthen, any profits or gains arising from transfer made by the depository or participant of such beneficial\ninterest in respect of securities shall be chargeable to income-tax as the income of the beneficial owner of\nthe previous year in which such transfer took place and shall not be regarded as income of the depository\nwho is deemed to be the registered owner of securities by virtue of sub-section (1) of section 10 of the\nDepositories Act, 1996, and for the purposes of—\n\n(i) section 48; and\n(ii) proviso to clause (42A) of section 2,\n\nthe cost of acquisition and the period of holding of any securities shall be determined on the basis of the\nfirst-in-first-out method.\nExplanation.—For the purposes of this sub-section, the expressions "beneficial owner", "depository" and\n"security" shall have the meanings respectively assigned to them in clauses (a), (e) and (l) of sub-section (1)\nof section 2 of the Depositories Act, 1996.\n(3) The profits or gains arising from the transfer of a capital asset by a person to a firm or other association\nof persons or body of individuals (not being a company or a co-operative society) in which he is or becomes\na partner or member, by way of capital contribution or otherwise, shall be chargeable to tax as his income of\nthe previous year in which such transfer takes place and, for the purposes of section 48, the amount recorded\nin the books of account of the firm, association or body as the value of the capital asset shall be deemed to\nbe the full value of the consideration received or accruing as a result of the transfer of the capital asset.\n82a[(4) Notwithstanding anything contained in sub-section (1), where a specified person receives during the\nprevious year any money or capital asset or both from a specified entity in connection with the\nreconstitution of such specified entity, then any profits or gains arising from such receipt by the specified\nperson shall be chargeable to income-tax as income of such specified entity under the head "Capital gains"\nand shall be deemed to be the income of such specified entity of the previous year in which such money or\ncapital asset or both were received by the specified person, and notwithstanding anything to the contrary\ncontained in this Act, such profits or gains shall be determined in accordance with the following formula,\nnamely:—\n\nA = B + C – D\nWhere,\n\n215 of 801\n\n\n\nA = income chargeable to income-tax under this sub section as income of the specified entity under the\nhead "Capital gains";\nB = value of any money received by the specified person from the specified entity on the date of such\nreceipt;\nC = the amount of fair market value of the capital asset received by the specified person from the\nspecified entity on the date of such receipt; and\nD = the amount of balance in the capital account (represented in any manner) of the specified person\nin the books of account of the specified entity at the time of its reconstitution:\nProvided that if the value of "A" in the above formula is negative, its value shall be deemed to be\nzero:\nProvided further that the balance in the capital account of the specified person in the books of\naccount of the specified entity is to be calculated without taking into account the increase in the capital\naccount of the specified person due to revaluation of any asset or due to self-generated goodwill or\nany other self-generated asset.\n\nExplanation 1.—For the purposes of this sub-section,—\n(i) the expressions "reconstitution of the specified entity", "specified entity" and "specified person" shall'),
                ),
                Result(
                    (attributes = {}),
                    (file_id = "file-Cswz8u47L6Ss5uCxPGfTPA"),
                    (filename = "income-tax-act-1961-amended-2024.pdf"),
                    (score = 0.4197),
                    (text =
                        'Explanation.—For the purposes of this sub-section, the expression "insurer" shall have the meaning\nassigned to it in clause (9) of section 2 of the Insurance Act, 1938 (4 of 1938).\n81[(1B) Notwithstanding anything contained in sub-section (1), where any person receives at any time\nduring any previous year any amount under a unit linked insurance policy, to which exemption under clause\n(10D) of section 10 does not apply on account of the applicability of the fourth and fifth provisos thereof,\nincluding the amount allocated by way of bonus on such policy, then, any profits or gains arising from\nreceipt of such amount by such person shall be chargeable to income-tax under the head "Capital gains" and\nshall be deemed to be the income of such person of the previous year in which such amount was received\nand the income taxable shall be calculated in such manner as may be prescribed82.]\n(2) Notwithstanding anything contained in sub-section (1), the profits or gains arising from the transfer by\nway of conversion by the owner of a capital asset into, or its treatment by him as stock-in-trade of a business\ncarried on by him shall be chargeable to income-tax as his income of the previous year in which such stock-\nin-trade is sold or otherwise transferred by him and, for the purposes of section 48, the fair market value of\nthe asset on the date of such conversion or treatment shall be deemed to be the full value of the\nconsideration received or accruing as a result of the transfer of the capital asset.\n(2A) Where any person has had at any time during previous year any beneficial interest in any securities,\nthen, any profits or gains arising from transfer made by the depository or participant of such beneficial\ninterest in respect of securities shall be chargeable to income-tax as the income of the beneficial owner of\nthe previous year in which such transfer took place and shall not be regarded as income of the depository\nwho is deemed to be the registered owner of securities by virtue of sub-section (1) of section 10 of the\nDepositories Act, 1996, and for the purposes of—\n\n(i) section 48; and\n(ii) proviso to clause (42A) of section 2,\n\nthe cost of acquisition and the period of holding of any securities shall be determined on the basis of the\nfirst-in-first-out method.\nExplanation.—For the purposes of this sub-section, the expressions "beneficial owner", "depository" and\n"security" shall have the meanings respectively assigned to them in clauses (a), (e) and (l) of sub-section (1)\nof section 2 of the Depositories Act, 1996.\n(3) The profits or gains arising from the transfer of a capital asset by a person to a firm or other association\nof persons or body of individuals (not being a company or a co-operative society) in which he is or becomes\na partner or member, by way of capital contribution or otherwise, shall be chargeable to tax as his income of\nthe previous year in which such transfer takes place and, for the purposes of section 48, the amount recorded\nin the books of account of the firm, association or body as the value of the capital asset shall be deemed to\nbe the full value of the consideration received or accruing as a result of the transfer of the capital asset.'),
                ),
                Result(
                    (attributes = {}),
                    (file_id = "file-Cswz8u47L6Ss5uCxPGfTPA"),
                    (filename = "income-tax-act-1961-amended-2024.pdf"),
                    (score = 0.3076),
                    (text =
                        '(a) towards the whole or a part of the cost of the asset; or\n(b) towards repayment of the whole or a part of the moneys borrowed by him from any person, directly or\n\nindirectly, in any foreign currency specifically for the purpose of acquiring the asset along with\ninterest, if any,\n\nthe amount by which the liability as aforesaid is so increased or reduced during such previous year and\nwhich is taken into account at the time of making the payment, irrespective of the method of accounting\nadopted by the assessee, shall be added to, or, as the case may be, deducted from—\n\n(i) the actual cost of the asset as defined in clause (1) of section 43; or\n(ii) the amount of expenditure of a capital nature referred to in clause (iv) of sub-section (1) of section 35;\n\nor\n(iii) the amount of expenditure of a capital nature referred to in section 35A; or\n(iv) the amount of expenditure of a capital nature referred to in clause (ix) of sub-section (1) of section 36;\n\nor\n(v) the cost of acquisition of a capital asset (not being a capital asset referred to in section 50) for the\n\npurposes of section 48,\n\n195 of 801\n\n\n\nand the amount arrived at after such addition or deduction shall be taken to be the actual cost of the asset or\nthe amount of expenditure of a capital nature or, as the case may be, the cost of acquisition of the capital\nasset as aforesaid:\nProvided that where an addition to or deduction from the actual cost or expenditure or cost of acquisition\nhas been made under this section, as it stood immediately before its substitution by the Finance Act, 2002,\non account of an increase or reduction in the liability as aforesaid, the amount to be added to, or, as the case\nmay be, deducted under this section from, the actual cost or expenditure or cost of acquisition at the time of\nmaking the payment shall be so adjusted that the total amount added to, or, as the case may be, deducted\nfrom, the actual cost or expenditure or cost of acquisition, is equal to the increase or reduction in the\naforesaid liability taken into account at the time of making payment.\nExplanation 1.—In this section, unless the context otherwise requires,—\n(a) "rate of exchange" means the rate of exchange determined or recognised by the Central Government for\nthe conversion of Indian currency into foreign currency or foreign currency into Indian currency;\n(b) "foreign currency" and "Indian currency" have the meanings respectively assigned to them in section 2\nof the Foreign Exchange Management Act, 1999 (42 of 1999).\nExplanation 2.—Where the whole or any part of the liability aforesaid is met, not by the assessee, but,\ndirectly or indirectly, by any other person or authority, the liability so met shall not be taken into account for\nthe purposes of this section.\nExplanation 3.—Where the assessee has entered into a contract with an authorised dealer as defined in\nsection 2 of the Foreign Exchange Management Act, 1999 (42 of 1999), for providing him with a specified\nsum in a foreign currency on or after a stipulated future date at the rate of exchange specified in the contract\nto enable him to meet the whole or any part of the liability aforesaid, the amount, if any, to be added to, or\ndeducted from, the actual cost of the asset or the amount of expenditure of a capital nature or, as the case\nmay be, the cost of acquisition of the capital asset under this section shall,'),
                ),
                Result(
                    (attributes = {}),
                    (file_id = "file-Cswz8u47L6Ss5uCxPGfTPA"),
                    (filename = "income-tax-act-1961-amended-2024.pdf"),
                    (score = 0.2782),
                    (text =
                        'assets not to be charged in certain cases\n\tSection 54EA - Capital gain on transfer of long-term capital assets not to be charged in the case of investment in specified securities\n\tSection 54EB - Capital gain on transfer of long-term capital assets not to be charged in certain cases\n\tSection 54EC - Capital gain not to be charged on investment in certain bonds\n\tSection 54ED - Capital gain on transfer of certain listed securities or unit not to be charged in certain cases\n\tSection 54EE - Capital gain not to be charged on investment in units of a specified fund\n\tSection 54F - Capital gain on transfer of certain capital assets not to be charged in case of investment in residential house\n\tSection 54G - Exemption of capital gains on transfer of assets in cases of shifting of industrial undertaking from urban area\n\tSection 54GA - Exemption of capital gains on transfer of assets in cases of shifting of industrial undertaking from urban area to any Special Economic Zone\n\tSection 54GB - Capital gain on transfer of residential property not to be charged in certain cases\n\tSection 54H - Extension of time for acquiring new asset or depositing or investing amount of capital gain\n\tSection 55 - Meaning of "adjusted", "cost of improvement" and "cost of acquisition"\n\tSection 55A - Reference to Valuation Officer\n\tSection 56 - Income from other sources\n\tSection 57 - Deductions\n\tSection 58 - Amounts not deductible\n\tSection 59 - Profits chargeable to tax\n\tSection 60 - Transfer of income where there is no transfer of assets\n\tSection 61 - Revocable transfer of assets\n\tSection 62 - Transfer irrevocable for a specified period\n\tSection 63 - "Transfer" and "revocable transfer" defined\n\tSection 64 - Income of individual to include income of spouse, minor child, etc\n\tSection 65 - Liability of person in respect of income included in the income of another person\n\tSection 66 - Total income\n\tSection 67 - Method of computing a partner\'s share in the income of the firm\n\tSection 67A - Method of computing a member\'s share in income of association of persons or body of individuals\n\tSection 68 - Cash credits\n\tSection 69 - Unexplained investments\n\tSection 69A - Unexplained money, etc\n\tSection 69B - Amount of investments, etc. not fully disclosed in books of account\n\tSection 69C - Unexplained expenditure, etc\n\tSection 69D - Amount borrowed or repaid on hundi\n\tSection 70 - Set off of loss from one source against income from another source under the same head of income\n\tSection 71 - Set off of loss from one head against income from another\n\tSection 71A - Transitional provisions for set off of loss under the head "Income from house property"\n\tSection 71B - Carry forward and set off of loss from house property\n\tSection 72 - Carry forward and set off of business losses\n\tSection 72A - Provisions relating to carry forward and set off of accumulated loss and unabsorbed depreciation allowance in amalgamation or demerger,'),
                ),
                Result(
                    (attributes = {}),
                    (file_id = "file-Cswz8u47L6Ss5uCxPGfTPA"),
                    (filename = "income-tax-act-1961-amended-2024.pdf"),
                    (score = 0.2387),
                    (text =
                        'the amount to be added to, or, as the case\nmay be, deducted under this section from, the actual cost or expenditure or cost of acquisition at the time of\nmaking the payment shall be so adjusted that the total amount added to, or, as the case may be, deducted\nfrom, the actual cost or expenditure or cost of acquisition, is equal to the increase or reduction in the\naforesaid liability taken into account at the time of making payment.\nExplanation 1.—In this section, unless the context otherwise requires,—\n(a) "rate of exchange" means the rate of exchange determined or recognised by the Central Government for\nthe conversion of Indian currency into foreign currency or foreign currency into Indian currency;\n(b) "foreign currency" and "Indian currency" have the meanings respectively assigned to them in section 2\nof the Foreign Exchange Management Act, 1999 (42 of 1999).\nExplanation 2.—Where the whole or any part of the liability aforesaid is met, not by the assessee, but,\ndirectly or indirectly, by any other person or authority, the liability so met shall not be taken into account for\nthe purposes of this section.\nExplanation 3.—Where the assessee has entered into a contract with an authorised dealer as defined in\nsection 2 of the Foreign Exchange Management Act, 1999 (42 of 1999), for providing him with a specified\nsum in a foreign currency on or after a stipulated future date at the rate of exchange specified in the contract\nto enable him to meet the whole or any part of the liability aforesaid, the amount, if any, to be added to, or\ndeducted from, the actual cost of the asset or the amount of expenditure of a capital nature or, as the case\nmay be, the cost of acquisition of the capital asset under this section shall, in respect of so much of the sum\nspecified in the contract as is available for discharging the liability aforesaid, be computed with reference to\nthe rate of exchange specified therein.\n\nTaxation of foreign exchange fluctuation.\n43AA. (1) Subject to the provisions of section 43A, any gain or loss arising on account of any change in\nforeign exchange rates shall be treated as income or loss, as the case may be, and such gain or loss shall be\ncomputed in accordance with the income computation and disclosure standards notified under sub-section\n(2) of section 145.\n(2) For the purposes of sub-section (1), gain or loss arising on account of the effects of change in foreign\nexchange rates shall be in respect of all foreign currency transactions, including those relating to—\n\n(i) monetary items and non-monetary items;\n(ii) translation of financial statements of foreign operations;\n(iii) forward exchange contracts;\n(iv) foreign currency translation reserves.\n\nCertain deductions to be only on actual payment.\n43B. Notwithstanding anything contained in any other provision of this Act, a deduction otherwise\nallowable under this Act in respect of—\n\n(a) any sum payable by the assessee by way of tax, duty, cess or fee, by whatever name called, under any\nlaw for the time being in force, or\n\n(b) any sum payable by the assessee as an employer by way of contribution to any provident fund or\nsuperannuation fund or gratuity fund or any other fund for the welfare of employees, or\n\n(c) any sum referred to in clause (ii) of sub-section (1) of section 36, or\n\n196 of 801\n\n\n\n(d) any sum payable by the assessee as interest on any loan or borrowing from any public financial\ninstitution or a State financial corporation or a State industrial investment corporation, in accordance\nwith the terms and conditions of the agreement governing such loan or borrowing, or'),
                ),
                Result(
                    (attributes = {}),
                    (file_id = "file-Cswz8u47L6Ss5uCxPGfTPA"),
                    (filename = "income-tax-act-1961-amended-2024.pdf"),
                    (score = 0.2232),
                    (text =
                        '(b) the successor in business has obtained, whether in cash or in any other manner whatsoever, any amount\nin respect of which loss or expenditure was incurred by the first-mentioned person or some benefit in\nrespect of the trading liability referred to in clause (a) by way of remission or cessation thereof, the\namount obtained by the successor in business or the value of benefit accruing to the successor in\nbusiness shall be deemed to be profits and gains of the business or profession, and accordingly\nchargeable to income-tax as the income of that previous year.\n\nExplanation 1.—For the purposes of this sub-section, the expression "loss or expenditure or some benefit in\nrespect of any such trading liability by way of remission or cessation thereof" shall include the remission or\ncessation of any liability by a unilateral act by the first-mentioned person under clause (a) or the successor\nin business under clause (b) of that sub-section by way of writing off such liability in his accounts.\nExplanation 2.—For the purposes of this sub-section, "successor in business" means,—\n\n186 of 801\n\n\n\n(i) where there has been an amalgamation of a company with another company, the amalgamated\ncompany;\n\n(ii) where the first-mentioned person is succeeded by any other person in that business or profession, the\nother person;\n\n(iii) where a firm carrying on a business or profession is succeeded by another firm, the other firm;\n(iv) where there has been a demerger, the resulting company.\n\n(2) Where any building, machinery, plant or furniture,—\n(a) which is owned by the assessee;\n(b) in respect of which depreciation is claimed under clause (i) of sub-section (1) of section 32; and\n(c) which was or has been used for the purposes of business,\n\nis sold, discarded, demolished or destroyed and the moneys payable in respect of such building, machinery,\nplant or furniture, as the case may be, together with the amount of scrap value, if any, exceeds the written\ndown value, so much of the excess as does not exceed the difference between the actual cost and the written\ndown value shall be chargeable to income-tax as income of the business of the previous year in which the\nmoneys payable for the building, machinery, plant or furniture became due.\nExplanation.—Where the moneys payable in respect of the building, machinery, plant or furniture referred\nto in this sub-section become due in a previous year in which the business for the purpose of which the\nbuilding, machinery, plant or furniture was being used is no longer in existence, the provision of this sub-\nsection shall apply as if the business is in existence in that previous year.\n(2A) [***]\n(3) Where an asset representing expenditure of a capital nature on scientific research within the meaning of\nclause (iv) of sub-section (1), or clause (c) of sub-section (2B), of section 35, read with clause (4) of section\n43, is sold, without having been used for other purposes, and the proceeds of the sale together with the total\namount of the deductions made under clause (i) or, as the case may be, the amount of the deduction under\nclause (ia) of sub-section (2), or clause (c) of sub-section (2B), of section 35 exceed the amount of the\ncapital expenditure, the excess or the amount of the deductions so made, whichever is the less, shall be\nchargeable to income-tax as income of the business or profession of the previous year in which the sale took\nplace.'),
                ),
                Result(
                    (attributes = {}),
                    (file_id = "file-Cswz8u47L6Ss5uCxPGfTPA"),
                    (filename = "income-tax-act-1961-amended-2024.pdf"),
                    (score = 0.2101),
                    (text =
                        '(iii) "payment has actually been made" means the actual payment of expenditure irrespective of the\nprevious year in which the liability for the expenditure was incurred according to the method of\naccounting regularly employed by the assessee or payable in such manner as may be prescribed11.\n\n_________________________________________________\n\n11. See rule 6A.\n\n157 of 801\n\n\n\nExpenditure for obtaining licence to operate telecommunication services.\n35ABB. (1) In respect of any expenditure, being in the nature of capital expenditure, incurred for acquiring\nany right to operate telecommunication services either before the commencement of the business to operate\ntelecommunication services or thereafter at any time during any previous year and for which payment has\nactually been made to obtain a licence, there shall, subject to and in accordance with the provisions of this\nsection, be allowed for each of the relevant previous years, a deduction equal to the appropriate fraction of\nthe amount of such expenditure.\nExplanation.—For the purposes of this section,—\n\n (i)  "relevant previous years" means,—\n(A)  in a case where the licence fee is actually paid before the commencement of the business to\n\noperate telecommunication services, the previous years beginning with the previous year in\nwhich such business commenced;\n\n(B)  in any other case, the previous years beginning with the previous year in which the licence fee\nis actually paid,\n\nand the subsequent previous year or years during which the licence, for which the fee is paid, shall be\nin force;\n\n(ii)  "appropriate fraction" means the fraction the numerator of which is one and the denominator of which\nis the total number of the relevant previous years;\n\n(iii) "payment has actually been made" means the actual payment of expenditure irrespective of the\nprevious year in which the liability for the expenditure was incurred according to the method of\naccounting regularly employed by the assessee.\n\n(2) Where the licence is transferred and the proceeds of the transfer (so far as they consist of capital sums)\nare less than the expenditure incurred remaining unallowed, a deduction equal to such expenditure\nremaining unallowed, as reduced by the proceeds of the transfer, shall be allowed in respect of the previous\nyear in which the licence is transferred.\n(3) Where the whole or any part of the licence is transferred and the proceeds of the transfer (so far as they\nconsist of capital sums) exceed the amount of the expenditure incurred remaining unallowed, so much of the\nexcess as does not exceed the difference between the expenditure incurred to obtain the licence and the\namount of such expenditure remaining unallowed shall be chargeable to income-tax as profits and gains of\nthe business in the previous year in which the licence has been transferred.\nExplanation.—Where the licence is transferred in a previous year in which the business is no longer in\nexistence, the provisions of this sub-section shall apply as if the business is in existence in that previous\nyear.\n(4) Where the whole or any part of the licence is transferred and the proceeds of the transfer (so far as they\nconsist of capital sums) are not less than the amount of expenditure incurred remaining unallowed, no\ndeduction for such expenditure shall be allowed under sub-section (1) in respect of the previous year in\nwhich the licence is transferred or in respect of any subsequent previous year or years.\n(5) Where a part of the licence is transferred in a previous year and sub-section (3) does not apply, the\ndeduction to be allowed under sub-section (1) for expenditure incurred remaining unallowed shall be arrived\nat by—\n\n(a)  subtracting the proceeds of transfer (so far as they consist of capital sums) from the expenditure\nremaining unallowed; and'),
                ),
                Result(
                    (attributes = {}),
                    (file_id = "file-Cswz8u47L6Ss5uCxPGfTPA"),
                    (filename = "income-tax-act-1961-amended-2024.pdf"),
                    (score = 0.1988),
                    (text =
                        'Charge of tax where shares of members in association of persons or body of individuals unknown, etc.\n167B. (1) Where the individual shares of the members of an association of persons or body of individuals\n(other than a company or a co-operative society or a society registered under the Societies Registration Act,\n1860 (21 of 1860) or under any law corresponding to that Act in force in any part of India) in the whole or\nany part of the income of such association or body are indeterminate or unknown, tax shall be charged on\nthe total income of the association or body at the maximum marginal rate :\nProvided that, where the total income of any member of such association or body is chargeable to tax at a\nrate which is higher than the maximum marginal rate, tax shall be charged on the total income of the\nassociation or body at such higher rate.\n(2) Where, in the case of an association of persons or body of individuals as aforesaid [not being a case\nfalling under sub-section (1)],—\n\n (i) the total income of any member thereof for the previous year (excluding his share from such\nassociation or body) exceeds the maximum amount which is not chargeable to tax in the case of that\nmember under the Finance Act of the relevant year, tax shall be charged on the total income of the\nassociation or body at the maximum marginal rate;\n\n(ii) any member or members thereof is or are chargeable to tax at a rate or rates which is or are higher than\nthe maximum marginal rate, tax shall be charged on that portion or portions of the total income of the\nassociation or body which is or are relatable to the share or shares of such member or members at such\nhigher rate or rates, as the case may be, and the balance of the total income of the association or body\nshall be taxed at the maximum marginal rate.\n\nExplanation.—For the purposes of this section, the individual shares of the members of an association of\npersons or body of individuals in the whole or any part of the income of such association or body shall be\ndeemed to be indeterminate or unknown if such shares (in relation to the whole or any part of such income)\nare indeterminate or unknown on the date of formation of such association or body or at any time thereafter.\n\nLiability of partners of limited liability partnership in liquidation.\n167C. Notwithstanding anything contained in the Limited Liability Partnership Act, 2008 (6 of 2009),\nwhere any tax due from a limited liability partnership in respect of any income of any previous year or from\nany other person in respect of any income of any previous year during which such other person was a\nlimited liability partnership cannot be recovered, in such case, every person who was a partner of the limited\nliability partnership at any time during the relevant previous year, shall be jointly and severally liable for the\npayment of such tax unless he proves that the non-recovery cannot be attributed to any gross neglect,\nmisfeasance or breach of duty on his part in relation to the affairs of the limited liability partnership.\nExplanation.—For the purposes of this section, the expression "tax due" includes penalty, interest or any\nother sum payable under the Act.\n\n562 of 801\n\n\n\nE.—Executors\nExecutors.\n168. (1) Subject as hereinafter provided, the income of the estate of a deceased person shall be chargeable to\ntax in the hands of the executor,—\n\n (a) if there is only one executor, then, as if the executor were an individual; or\n (b) if there are more executors than one, then, as if the executors were an association of persons;'),
                ),
                Result(
                    (attributes = {}),
                    (file_id = "file-Cswz8u47L6Ss5uCxPGfTPA"),
                    (filename = "income-tax-act-1961-amended-2024.pdf"),
                    (score = 0.1822),
                    (text =
                        "which is held by a non-resident by way of investment, directly or indirectly, in Category-I foreign\nportfolio investor under the Securities and Exchange Board of India (Foreign Portfolio Investors)\nRegulations, 2019, made under the Securities and Exchange Board of India Act, 1992 (15 of 1992):\n29a[Provided also that nothing contained in this Explanation shall apply to—\n\n   (i) an assessment or reassessment to be made under section 143, section 144, section 147 or\nsection 153A or section 153C; or\n\n  (ii) an order to be passed enhancing the assessment or reducing a refund already made or otherwise\nincreasing the liability of the assessee under section 154; or\n\n (iii) an order to be passed deeming a person to be an assessee in default under sub-section (1) of\nsection 201,\n\nin respect of income accruing or arising through or from the transfer of an asset or a capital asset\nsituate in India in consequence of the transfer of a share or interest in a company or entity registered or\nincorporated outside India made before the 28th day of May, 2012:\nProvided also that where—\n\n   (i) an assessment or reassessment has been made under section 143, section 144, section 147 or\nsection 153A or section 153C; or\n\n  (ii) an order has been passed enhancing the assessment or reducing a refund already made or\notherwise increasing the liability of the assessee under section 154; or\n\n (iii) an order has been passed deeming a person to be an assessee in default under sub-section (1) of\nsection 201; or\n\n (iv) an order has been passed imposing a penalty under Chapter XXI or under section 221,\nin respect of income accruing or arising through or from the transfer of an asset or a capital asset\nsituate in India in consequence of the transfer of a share or interest in a company or entity registered or\nincorporated outside India made before the 28th day of May, 2012 and the person in whose case such\nassessment or reassessment or order has been passed or made, as the case may be, fulfils the specified\nconditions, then, such assessment or reassessment or order, to the extent it relates to the said income,\nshall be deemed never to have been passed or made, as the case may be:\nProvided also that where any amount becomes refundable to the person referred to in fifth proviso as\na consequence of him fulfilling the specified conditions, then, such amount shall be refunded to him,\nbut no interest under section 244A shall be paid on that amount.\nExplanation.—For the purposes of fifth and sixth provisos, the specified conditions shall be as\nprovided hereunder:—\n\n  (i) where the said person has filed any appeal before an appellate forum or any writ petition before\nthe High Court or the Supreme Court against any order in respect of said income, he shall\neither withdraw or submit an undertaking to withdraw such appeal or writ petition, in such\nform and manner as may be prescribed30;\n\n  (ii) where the said person has initiated any proceeding for arbitration, conciliation or mediation, or\nhas given any notice thereof under any law for the time being in force or under any agreement\n\n25 of 801\n\n\n\nentered into by India with any other country or territory outside India, whether for protection of\ninvestment or otherwise, he shall either withdraw or shall submit an undertaking to withdraw\nthe claim, if any, in such proceedings or notice, in such form and manner as may be\nprescribed30;"),
                ),
                Result(
                    (attributes = {}),
                    (file_id = "file-Cswz8u47L6Ss5uCxPGfTPA"),
                    (filename = "income-tax-act-1961-amended-2024.pdf"),
                    (score = 0.182),
                    (text =
                        'Provided that the provisions contained in this Explanation shall also apply to the income attributable\nto the transactions or activities referred to in Explanation 2A.\nExplanation 4.—For the removal of doubts, it is hereby clarified that the expression "through" shall\nmean and include and shall be deemed to have always meant and included "by means of", "in\nconsequence of" or "by reason of".\nExplanation 5.29—For the removal of doubts, it is hereby clarified that an asset or a capital asset being\nany share or interest in a company or entity registered or incorporated outside India shall be deemed to\n\n24 of 801\n\n\n\nbe and shall always be deemed to have been situated in India, if the share or interest derives, directly\nor indirectly, its value substantially from the assets located in India:\nProvided that nothing contained in this Explanation shall apply to an asset or capital asset, which is\nheld by a non-resident by way of investment, directly or indirectly, in a Foreign Institutional Investor\nas referred to in clause (a) of the Explanation to section 115AD for an assessment year commencing\non or after the 1st day of April, 2012 but before the 1st day of April, 2015:\nProvided further that nothing contained in this Explanation shall apply to an asset or capital asset,\nwhich is held by a non-resident by way of investment, directly or indirectly, in Category-I or\nCategory-II foreign portfolio investor under the Securities and Exchange Board of India (Foreign\nPortfolio Investors) Regulations, 2014 prior to their repeal, made under the Securities and Exchange\nBoard of India Act, 1992 (15 of 1992):\nProvided also that nothing contained in this Explanation shall apply to an asset or a capital asset,\nwhich is held by a non-resident by way of investment, directly or indirectly, in Category-I foreign\nportfolio investor under the Securities and Exchange Board of India (Foreign Portfolio Investors)\nRegulations, 2019, made under the Securities and Exchange Board of India Act, 1992 (15 of 1992):\n29a[Provided also that nothing contained in this Explanation shall apply to—\n\n   (i) an assessment or reassessment to be made under section 143, section 144, section 147 or\nsection 153A or section 153C; or\n\n  (ii) an order to be passed enhancing the assessment or reducing a refund already made or otherwise\nincreasing the liability of the assessee under section 154; or\n\n (iii) an order to be passed deeming a person to be an assessee in default under sub-section (1) of\nsection 201,\n\nin respect of income accruing or arising through or from the transfer of an asset or a capital asset\nsituate in India in consequence of the transfer of a share or interest in a company or entity registered or\nincorporated outside India made before the 28th day of May, 2012:\nProvided also that where—\n\n   (i) an assessment or reassessment has been made under section 143, section 144, section 147 or\nsection 153A or section 153C; or\n\n  (ii) an order has been passed enhancing the assessment or reducing a refund already made or\notherwise increasing the liability of the assessee under section 154; or\n\n (iii) an order has been passed deeming a person to be an assessee in default under sub-section (1) of\nsection 201; or\n\n (iv) an order has been passed imposing a penalty under Chapter XXI or under section 221,'),
                ),
                Result(
                    (attributes = {}),
                    (file_id = "file-Cswz8u47L6Ss5uCxPGfTPA"),
                    (filename = "income-tax-act-1961-amended-2024.pdf"),
                    (score = 0.1442),
                    (text =
                        'Explanation 3.—For the purposes of this clause,—\n\n (a) "concern" means a Hindu undivided family, or a firm or an association of persons or a\nbody of individuals or a company ;\n\n (b) a person shall be deemed to have a substantial interest in a concern, other than a\ncompany, if he is, at any time during the previous year, beneficially entitled to not less\nthan twenty per cent of the income of such concern ;\n\n(22A) "domestic company" means an Indian company, or any other company which, in respect of its\nincome liable to tax under this Act, has made the prescribed arrangements for the declaration\nand payment, within India, of the dividends (including dividends on preference shares) payable\nout of such income ;\n\n(22AA) "document" includes an electronic record as defined in clause (t) of sub-section (1) of section 2\nof the Information Technology Act, 2000 (21 of 2000);\n\n9 of 801\n\n\n\n (22AAA) "electoral trust" means a trust so approved by the Board in accordance with the scheme made in\nthis regard by the Central Government;\n\n(22B) "fair market value", in relation to a capital asset, means—\n  (i) the price that the capital asset would ordinarily fetch on sale in the open market on the\n\nrelevant date ; and\n (ii) where the price referred to in sub-clause (i) is not ascertainable, such price as may be\n\ndetermined in accordance with the rules made under this Act ;\n(23) (i) "firm" shall have the meaning assigned to it in the Indian Partnership Act, 1932 (9 of 1932),\n\nand shall include a limited liability partnership as defined in the Limited Liability Partnership\nAct, 2008 (6 of 2009);\n(ii) "partner" shall have the meaning assigned to it in the Indian Partnership Act, 1932 (9 of\n1932), and shall include,—\n\n (a) any person who, being a minor, has been admitted to the benefits of partnership; and\n (b) a partner of a limited liability partnership as defined in the Limited Liability\n\nPartnership Act, 2008 (6 of 2009);\n(iii) "partnership" shall have the meaning assigned to it in the Indian Partnership Act, 1932 (9\nof 1932), and shall include a limited liability partnership as defined in the Limited Liability\nPartnership Act, 2008 (6 of 2009);\n\n(23A) "foreign company" means a company which is not a domestic company;\n(23B) "fringe benefits" means any fringe benefits referred to in section 115WB;\n(23C) "hearing" includes communication of data and documents through electronic mode;\n\n(24) "income" includes—\n  (i) profits and gains ;\n (ii) dividend ;\n(iia) voluntary contributions received by a trust created wholly or partly for charitable or\n\nreligious purposes or by an institution established wholly or partly for such purposes or\nby an association or institution referred to in clause (21) or clause (23), or by a fund or\ntrust or institution referred to in sub-clause (iv) or sub-clause (v) or by any university or\nother educational institution referred to in sub-clause (iiiad) or sub-clause (vi) or by any\nhospital or other institution referred to in sub-clause (iiiae) or sub-clause (via) of clause\n(23C) of section 10 or by an electoral trust.\nExplanation.—For the purposes of this sub-clause, "trust" includes any other legal\nobligation ;'),
                ),
            ]),
        ),
        ResponseOutputMessage(
            (id = "msg_6843e6c9268c819eb666b14f4c05c2a70ecb5de5fa8226ff"),
            (content = [
                ResponseOutputText(
                    (annotations = [
                        AnnotationFileCitation(
                            (file_id = "file-Cswz8u47L6Ss5uCxPGfTPA"),
                            (index = 484),
                            (type = "file_citation"),
                            (filename = "income-tax-act-1961-amended-2024.pdf"),
                        ),
                    ]),
                    (text =
                        "Capital gains tax liability is the tax payable on the profit realized from the transfer or sale of a capital asset. It is calculated based on the type of asset, the duration for which it was held, and the applicable tax rates. For example, the tax on long-term capital gains (Gains from assets held for more than a specified period) is typically calculated at a certain percentage, such as twenty percent, but this can vary depending on specific conditions and the nature of the asset."),
                    (type = "output_text"),
                    (logprobs = None),
                ),
            ]),
            (role = "assistant"),
            (status = "completed"),
            (type = "message"),
        ),
    ]),
    (parallel_tool_calls = True),
    (temperature = 1.0),
    (tool_choice = "auto"),
    (tools = [
        FileSearchTool(
            (type = "file_search"),
            (vector_store_ids = ["vs_6843d4f0bb5c8191ae486696e53fcf60"]),
            (filters = None),
            (max_num_results = 20),
            (ranking_options = RankingOptions(
                (ranker = "auto"),
                (score_threshold = 0.0),
            )),
        ),
    ]),
    (top_p = 1.0),
    (background = False),
    (max_output_tokens = None),
    (previous_response_id = None),
    (reasoning = Reasoning(
        (effort = None),
        (generate_summary = None),
        (summary = None),
    )),
    (service_tier = "default"),
    (status = "completed"),
    (text = ResponseTextConfig((format = ResponseFormatText((type = "text"))))),
    (truncation = "disabled"),
    (usage = ResponseUsage(
        (input_tokens = 18150),
        (input_tokens_details = InputTokensDetails((cached_tokens = 0))),
        (output_tokens = 134),
        (output_tokens_details = OutputTokensDetails((reasoning_tokens = 0))),
        (total_tokens = 18284),
    )),
    (user = None),
    (store = True),
);

    Parse the AI response and format search results if present.
    '''
    for item in response.output:
        if item.type == "message":
            response_text = item.content[0].text if item.content else ""
            break
    return response_text

# -------------------------------------- Initialization ----------------------------------------- # 
logger = setup_logging()
logger.info("Starting application initialization...")

try:
    logger.info("Initializing OpenAI client...")
    client = OpenAI(api_key=st.secrets["OPENAI_API_KEY"])
    logger.info("OpenAI client initialized successfully")
except Exception as e:
    logger.error(f"Failed to initialize OpenAI client: {str(e)}")
    st.error("Failed to initialize AI service. Please check your API key configuration.")
    st.stop()

try:
    logger.info("Setting up Streamlit page configuration...")
    st.set_page_config(page_title="AccuTax AI :chart_with_upwards_trend:", page_icon="🤖")
    logger.info("Streamlit page configured successfully")
except Exception as e:
    logger.error(f"Failed to configure Streamlit page: {str(e)}")
    st.error("Failed to initialize the application interface.")
    st.stop()

st.title("AccuTax AI")
st.write("Your helpful assistant for tax advice")

# Initialize chat history
if "messages" not in st.session_state:
    logger.info("Initializing chat history...")
    st.session_state.messages = [{"role": "assistant", "content": "How can I _account_ for your needs today?"}]
    logger.info("Chat history initialized")

# Render messages from history
logger.debug("Rendering chat history...")
for message in st.session_state.messages:
    with st.chat_message(message["role"]):
        st.markdown(message["content"])

prompt = st.chat_input("Ask me anything about the Income Tax Act 1961 (Amended 2024) or related topics.")

# ------------------------------------ Run Streamlit App ---------------------------------------- # 
if prompt:
    # Add user message and display it
    st.session_state.messages.append({"role": "user", "content": prompt})
    with st.chat_message("user"):
        st.markdown(prompt)
        
    # Generate and display AI response
    with st.chat_message("assistant"):
        response = client.responses.create(
            model=MODEL,
            input=st.session_state.messages,
            stream=False,
            tools=[{"type": "file_search", "vector_store_ids": [VECTOR_STORE_ID], "max_num_results": 20}],
            tool_choice="required",
            include=["file_search_call.results"]
        )
        logger.debug(f"AI response received: {response}")
        if response.error:
            logger.error(f"AI response error: {response.error}")
            st.error("An error occurred while processing your request.")
            st.stop()
        response_text = parse_response(response)
        st.session_state.messages.append({"role": "assistant", "content": response_text})
        st.markdown(response_text)
